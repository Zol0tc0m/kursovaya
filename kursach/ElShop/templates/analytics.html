{% extends "admin/base_site.html" %}
{% load static %}
{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞{% endblock %}

{% block content %}
<h1>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞</h1>

<a href="{% url 'export_analytics_csv' %}?start_date={{ start_date }}&end_date={{ end_date }}"
   class="btn btn-success ml-3">
  ‚¨á –≠–∫—Å–ø–æ—Ä—Ç CSV
</a>
<hr>

<h2>üìä –ü—Ä–æ–¥–∞–∂–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h2>
<canvas id="categoryChart"></canvas>

<h2 class="mt-4">üí∞ –î–æ—Ö–æ–¥ –ø–æ –¥–Ω—è–º</h2>
<canvas id="revenueChart"></canvas>

<h2 class="mt-4">ü•á –¢–æ–ø-5 —Ç–æ–≤–∞—Ä–æ–≤</h2>
<canvas id="topProductChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{# –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ JS #}
{{ category_labels|json_script:"category-labels" }}
{{ category_data|json_script:"category-data" }}
{{ revenue_labels|json_script:"revenue-labels" }}
{{ revenue_data|json_script:"revenue-data" }}
{{ top_labels|json_script:"top-labels" }}
{{ top_data|json_script:"top-data" }}

<script>
const categoryLabels = JSON.parse(document.getElementById('category-labels').textContent);
const categoryData   = JSON.parse(document.getElementById('category-data').textContent);
const revenueLabels  = JSON.parse(document.getElementById('revenue-labels').textContent);
const revenueData    = JSON.parse(document.getElementById('revenue-data').textContent);
const topLabels      = JSON.parse(document.getElementById('top-labels').textContent);
const topData        = JSON.parse(document.getElementById('top-data').textContent);

// --- –ü—Ä–æ–¥–∞–∂–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º ---
new Chart(document.getElementById('categoryChart'), {
  type: 'bar',
  data: {
    labels: categoryLabels,
    datasets: [{ label: '–ü—Ä–æ–¥–∞–Ω–æ –µ–¥–∏–Ω–∏—Ü', data: categoryData }]
  },
  options: { responsive: true }
});

// --- –î–æ—Ö–æ–¥ –ø–æ –¥–Ω—è–º ---
new Chart(document.getElementById('revenueChart'), {
  type: 'line',
  data: {
    labels: revenueLabels,
    datasets: [{ label: '–î–æ—Ö–æ–¥ (‚ÇΩ)', data: revenueData, fill: false, tension: 0.2 }]
  },
  options: { responsive: true }
});

// --- –¢–æ–ø-5 —Ç–æ–≤–∞—Ä–æ–≤ ---
new Chart(document.getElementById('topProductChart'), {
  type: 'pie',
  data: {
    labels: topLabels,
    datasets: [{ data: topData }]
  },
  options: { responsive: true }
});
</script>
{% endblock %}
