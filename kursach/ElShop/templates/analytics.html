{% extends "admin/base_site.html" %}
{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞{% endblock %}

{% block content %}
<h1>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞</h1>
<a href="{% url 'export_analytics_csv' %}?start_date={{ start_date }}&end_date={{ end_date }}" class="btn btn-success ml-3">
  ‚¨á –≠–∫—Å–ø–æ—Ä—Ç CSV
</a>
<hr>

<h2>üìä –ü—Ä–æ–¥–∞–∂–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h2>
<canvas id="categoryChart"></canvas>

<h2 class="mt-4">üí∞ –î–æ—Ö–æ–¥ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é</h2>
<canvas id="revenueChart"></canvas>

<h2 class="mt-4">ü•á –¢–æ–ø-5 —Ç–æ–≤–∞—Ä–æ–≤</h2>
<canvas id="topProductChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// --- –ü—Ä–æ–¥–∞–∂–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞) ---
const categoryLabels = [{% for c in category_sales %}'{{ c.product__categories__name|default:"–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" }}',{% endfor %}];
const categoryData = [{% for c in category_sales %}{{ c.total_sold|default:0 }},{% endfor %}];

new Chart(document.getElementById('categoryChart'), {
    type: 'bar',
    data: {
        labels: categoryLabels,
        datasets: [{
            label: '–ü—Ä–æ–¥–∞–Ω–æ –µ–¥–∏–Ω–∏—Ü',
            data: categoryData,
            backgroundColor: '#007bff'
        }]
    },
    options: { responsive: true }
});

// --- –î–æ—Ö–æ–¥ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é (–ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫) ---
const revenueLabels = [{% for d in daily_revenue %}'{{ d.day }}',{% endfor %}];
const revenueData = [{% for d in daily_revenue %}{{ d.total|default:0 }},{% endfor %}];

new Chart(document.getElementById('revenueChart'), {
    type: 'line',
    data: {
        labels: revenueLabels,
        datasets: [{
            label: '–î–æ—Ö–æ–¥ (‚ÇΩ)',
            data: revenueData,
            borderColor: 'green',
            fill: false,
            tension: 0.2
        }]
    },
    options: { responsive: true }
});

// --- –¢–æ–ø-5 —Ç–æ–≤–∞—Ä–æ–≤ (–∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞) ---
const topLabels = [{% for p in top_products %}'{{ p.product__name }}',{% endfor %}];
const topData = [{% for p in top_products %}{{ p.total_sold|default:0 }},{% endfor %}];

new Chart(document.getElementById('topProductChart'), {
    type: 'pie',
    data: {
        labels: topLabels,
        datasets: [{
            data: topData,
            backgroundColor: [
                '#007bff','#28a745','#ffc107','#dc3545','#6f42c1'
            ]
        }]
    },
    options: { responsive: true }
});
</script>
{% endblock %}
